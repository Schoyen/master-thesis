\chapter{Coupled cluster theory}
    % TODO: Why is coupled cluster so awesome?
    % Discuss size-consistency and size-extensivity.
    % Discuss exponential scaling catching all excitations of the reference
    % state.
    % Discuss how higher CI/CC coefficients/amplitudes contributing less than
    % the singles and doubles coefficients/amplitudes.
    % That is, for CCSDTQ, the doubles amplitudes will contribute more to the
    % quadruply excited states than the quadruple amplitudes.
    % See Crawford & Schaefer for a good intro to these topics.


    \section{Time-independent coupled cluster theory}
        This section follows closely the derivation done in
        \citetitle{crawford2000introduction} by
        \citeauthor{crawford2000introduction} \cite{crawford2000introduction}.
        Starting with the time-independent Schrödinger equation, the coupled
        cluster method seeks to find a many-body wave function $\ketcc$ which
        solves
        \begin{align}
            \hamil\ketcc = \energycc\ketcc.
        \end{align}
        Start from a single reference Slater determinant $\ketslat$ coupled
        cluster makes the ansatz that the true many-body wave function is given
        by
        \begin{align}
            \ketcc \equiv e^{\clust}\ketslat
            = \sum_{n = 0}^{\infty}\frac{1}{n!}\clust^n\ketslat,
            \label{eq:cc_wave_function}
        \end{align}
        where the \emph{cluster operator} $\clust$ is given by a sum of excitation
        operators $\clust_{\mu}$.
        \begin{align}
            \clust &= \sum_{\mu = 1}^{\infty} \clust_{\mu}
            = \clustamp^a_i\ccr{a}\can{i}
            + \para{\frac{1}{2!}}^2\clustamp^{ab}_{ij}\ccr{a}\ccr{b}\can{i}\can{j}
            + \para{\frac{1}{3!}}^2\clustamp^{abc}_{ijk}
            \ccr{a}\ccr{b}\ccr{c}\can{i}\can{j}\can{k}
            + \dots,
            \label{eq:cluster-operator}
        \end{align}
        where the cluster amplitudes $\clustamp^{abc\dots}_{ijk\dots}$ are the
        primary unknowns.
        In this formulation, the cluster amplitudes satisify the anti-symmetric
        properties
        \begin{align}
            \clustamp^{abc\dots}_{ijk\dots}
            = -\clustamp^{bac\dots}_{ijk\dots}
            = -\clustamp^{abc\dots}_{jik\dots}
            = \clustamp^{bac\dots}_{jik\dots},
        \end{align}
        where interchange of a pair of indices gives rise to a sign change.
        Furthermore, the cluster amplitudes commute with one another as the
        creation and annihilation operators run over non-overlapping sets of
        indices.
        Note that interchange of indices from upper to lower, or vice-versa, are
        not permitted.
        By inserting \autoref{eq:cc_wave_function} into the time-independent
        Schrödinger equation we get
        \begin{align}
            \hamil\ketcc
            = e^{\clust}\ketslat
            = \energycc e^{\clust}\ketslat
            = \energycc \ketcc.
        \end{align}
        Projecting onto the reference Slater determinant we are left with
        \begin{align}
            \braslat\hamil\ketcc
            &= \braslat\energycc e^{\clust}\ketslat
            = \energycc \braslat e^{\clust}\ketslat
            = \energycc,
            \label{eq:cc_energy}
        \end{align}
        where for orthonormal Slater determinants, the coupled cluster wave
        function assumes \emph{intermediate normalization}, viz.
        \begin{align}
            \braket{\slat}{\cc}
            &= \bra{\slat}\para{
                \1 + \clust + \frac{1}{2!}\clust^2 + \dots
            }\ket{\slat}
            = 1.
        \end{align}
        Using the same projection technique as for the energy equation, we can
        obtain expressions for the cluster amplitudes.
        All we have to do is project onto an excited reference state, where the
        order of the excitation decides which order of the amplitudes we are
        solving for.
        \begin{align}
            \bra{\slat_{\mu}}\hamil e^{\clust}\ketslat
            &= \energycc \bra{\slat_{\mu}} e^{\clust}\ketslat.
            \label{eq:cc_amp}
        \end{align}
        % TODO: Discuss how this equation arises.
        % Check the pink book chapter 13.1.4.
        Here the excitation order $\mu$ decides which amplitudes we are solving
        for, e.g., for the doubles cluster amplitudes $\clustamp^{ab}_{ij}$ we
        project onto the doubly excited reference state $\ket{\slat^{ab}_{ij}}$.
        These equations are non-linear due to the presences of the exponential
        function creating cross terms with other excited amplitudes.
        Furthermore, if we don't truncate the cluster operatar, $\clust$, we
        recover the exact wave function as in full configuration interaction,
        that is, within the space spanned by the basis of single-particle
        functions we are perusing.
        % TODO: Add proof of recovery of the exact wave function.
        The amplitude equations in \autoref{eq:cc_amp} must be solved
        iteratively in order to find a minimum of the energy.
        % TODO: Check this sentence again.

        By expanding the exponential cluster operator in a power series, as in
        \autoref{eq:cc_wave_function}, and inserting it into
        \autoref{eq:cc_energy} we get
        \begin{align}
            \bra{\slat}\hamil \ketcc
            &=
            \bra{\slat}\hamil
            \sum_{n = 0}^{\infty} \frac{1}{n!}\clust^n
            \ket{\slat}
            =
            \bra{\slat}\hamil\ket{\slat}
            + \bra{\slat}\hamil \clust \ket{\slat}
            + \frac{1}{2!}
            \bra{\slat} \hamil \clust^2 \ket{\slat}
            + \dots
            = \energycc.
        \end{align}
        Depending on the form of the Hamiltonian, we will get a natural
        truncation of the cluster operators.
        As a single cluster operator is at
        least an operator exciting a single particle in our reference state, an
        $n$-times exponentiated cluster operator will excite $n$ particles from
        the reference.
        Except for some rare cases in nuclear physics,
        % TODO: Find references for some articles dealing with three-body
        % problems.
        the Hamiltonian will \emph{at most} contain two-body elements and thus
        will only be able to excite or relax a pair of particles.
        As we are projecting onto the reference state the Hamiltonian is forced
        to relax the excitation done by the cluster operators in order to get a
        non-zero contribution.
        Thus, for a Hamiltonian with at most two-body operators the exponential
        power series gets truncated at $n = 2$ for the cluster operators, viz.
        \begin{align}
            \bra{\slat}\hamil \ketcc
            &=
            \bra{\slat}\hamil\ket{\slat}
            + \bra{\slat}\hamil \clust \ket{\slat}
            + \frac{1}{2!}
            \bra{\slat} \hamil \clust^2 \ket{\slat}
            = \energycc.
        \end{align}
        Note that this result is general irrespective of the truncation level
        chosen for the cluster operators themselves, which we'll discuss
        shortly.

        \subsection{Rewriting the coupled cluster equations}
            In order to get amiable equations for the coupled cluster energy and
            amplitudes, we left multiply the Hamiltonian by the inverse of the
            exponential cluster operator.
            We then get the equations
            \begin{gather}
                \braslat e^{-\clust} \hamil e^{\clust} \ketslat
                = \energycc,
                \label{eq:cc_energy_sim}
                \\
                \bra{\slat_{\mu}} e^{-\clust} \hamil e^{\clust} \ketslat
                = 0.
                \label{eq:cc_amp_sim}
            \end{gather}
            Even though \autoref{eq:cc_energy} and \autoref{eq:cc_amp} are
            theoretically correct, they are not tractable for a numerical
            implementation, unlike \autoref{eq:cc_energy_sim} and
            \autoref{eq:cc_amp_sim}.
            Furthermore, the amplitude equations are
            now decoupled from the energy equation, which will help conserve
            size-extensivity.
            % TODO: Elaborate on this point, see Crawford & Schaefer
            By applying the Baker-Campbell-Hausdorff formula, we are able to
            rewrite the Hamiltonian and the exponential operators as a linear
            combination of nested commutators between $\hamil$ and $\clust$.
            \begin{align}
                \simhamil
                &=
                e^{-\clust} \hamil e^{\clust}
                =
                \hamil
                + \com{\hamil}{\clust}
                + \frac{1}{2!}\com{
                    \com{
                        \hamil
                    }{
                        \clust
                    }
                }{
                    \clust
                }
                + \dots,
            \end{align}
            where $\simhamil$ is dubbed the \emph{similarity transformed
            Hamiltonian}.
            Introducing the normal-ordered Hamiltonian, $\hamil_N$, given by
            \begin{align}
                \hamil_N
                &= \hamil - \braslat\hamil\ketslat,
            \end{align}
            where the latter term is known as the \emph{reference energy} of the
            system, $\energyref \equiv \braslat\hamil\ketslat$.
            If the reference state is the Hartree-Fock state%
            \footnote{
                The reference state is more or less always the Hartree-Fock
                state in quantum chemistry computations.
            }
            all energy contribution beyond the reference energy is known as the
            \emph{correlation energy}.
            As the reference energy is just a number, the similarity transformed
            normal-ordered Hamiltonian takes on the form
            \begin{align}
                \simhamil_N
                &= e^{-\clust}\hamil_N e^{\clust}
                = e^{-\clust}\hamil e^{\clust} - \braslat\hamil\ketslat
                = \simhamil - \energyref.
            \end{align}


        \subsection{Truncated coupled cluster theory}

    \section{Time-dependent coupled cluster theory}
        Stuff!


        \subsection{Measuring the quality of the reference state in time}
            When evolving a system in time, we can -- and will -- get in a
            situation where the our initial state has little to no overlap with
            the time-evolved state.
            That is, we can get in a situation where
            \begin{align}
                \braket{\psi(t)}{\psi(0)} \approx 0,
            \end{align}
            where $\ket{\psi(0)}$ is some initial state and $\ket{\psi(t)}$ is
            the time-evolved state at a later time $t$.
            In time-dependent configuration interaction theory\footnote{
                Without intermediate normalization.
                % TODO: Check if this applies in general
            } this is handled automatically by the
            zero-order amplitude.
            \begin{gather}
                \ket{\ci(t)} = C_0(t)\ketslat + C^{a}_{i}(t)\ket{\slat^{a}_{i}} + \dots
                \implies \braket{\slat}{\ci(t)} = C_0(t),
            \end{gather}
            where $\ketslat$ is the reference determinant and we have
            orthonormal determinants.
            In time-dependent coupled cluster theory where we assume
            intermediate normalization, there is however a different story to be
            told.
            For the time-dependent coupled cluster wavefunction we have that
            \begin{gather}
                \ket{\cc(t)} = e^{\clust(t)}\ketslat
                = \para{
                    \1
                    + \clust(t)
                    + \dots
                }\ketslat
                \implies
                \braket{\slat}{\cc(t)} = 1.
            \end{gather}
            This might not look like much, but for strong fields, or long
            time-evolution, we quickly find states which have little to no
            overlap with the original reference state.
            When this is the case the cluster amplitudes are left with the job
            of both ``removing'' the reference state from the cluster wave
            function \emph{and} providing contribution from higher excited
            determinants \cite{pedersen2018symplectic}.
            Frustratingly enough the formulation of time-dependent coupled
            cluster with static spin-orbitals is not able to solve this problem.
            When $\braket{\slat}{\cc(t)} \to 0$, the magnitude of the amplitudes
            sky-rocket, the energy is no longer conserved (when the
            time-dependence in the Hamiltonian is turned off), and the data
            produced can no longer be trusted.
            % TODO: This can be shown theoretically. See article by Thomas and
            % Simen for the steps.
            Luckily, there is a solution\footnote{
                As far as the author can tell.
            } where we allow the spin-orbitals change in time along with the
            amplitudes.
            We will in the coming sections explore two versions of this scheme
            and demonstrate that this fixes the problems described by
            \citeauthor{pedersen2018symplectic} \cite{pedersen2018symplectic}.

            But, before we try to solve the problem, we can formulate a
            ``zero-order'' amplitude for the time-dependent coupled cluster wave
            function which does not solve the problem, but at least lets us
            measure how good or bad the reference state is in time.
            This is done by introducing a phase factor $\clustamp_0(t) \in
            \mathbb{C}$ which we insert in the exponential ansatz.
            \begin{gather}
                \ket{\cc(t)}
                = e^{\clustamp_0(t) + \clust(t)}\ketslat
                = e^{\clustamp_0(t)} e^{\clust(t)}\ketslat,
                \\
                \bra{\bicc(t)}
                = \braslat\para{\1 + \clustl(t)}
                e^{-\clustamp_0(t) - \clust(t)}
                = \braslat\para{\1 + \clustl(t)}
                e^{-\clust(t)} e^{-\clustamp_0(t)},
            \end{gather}
            where we've used that $\clustamp_0(t)$ is a number to separate it
            from the cluster amplitudes in the exponential.
            Regardless if $\clustamp_0(t)$ is real or not, the inclusion of the
            phase does not change any of the equations used in coupled cluster.
            However, we can now see that
            \begin{align}
                \braket{\slat}{\cc(t)} = e^{\clustamp_0(t)},
            \end{align}
            which tells us how good the reference state $\ketslat$ is at a later
            time $t$.
            Note that the inclusion of $\clustamp_0(t)$ is in no way able to be
            used as a amplitude to lower the presence of the reference as in the
            configuration interaction method.
            We also see that for $\clustamp_0(t) = 0$ we recover intermediate
            normalization and the known time-dependent coupled cluster method.
            The question remains how we can evaluate $\clustamp_0(t)$ from the
            coupled cluster equations.
            In general we find the time derivative of the cluster amplitudes
            from
            \begin{align}
                i\hslash \dpd[]{}{t}\clustamp_{\mu}
                &=
                \bra{\slat_{\mu}} e^{-\clust(t)} \hamil(t) e^{\clust(t)}
                \ketslat,
            \end{align}
            where $\mu$ denotes the excitation level of the reference slater
            determinant and the order of the cluster amplitudes as in
            \autoref{eq:cluster-operator}.
            By choosing $\mu = 0$ we are left with
            \begin{align}
                i\hslash \dpd[]{}{t}\clustamp_{0}
                &=
                \bra{\slat} e^{-\clust(t)} \hamil(t) e^{\clust(t)}
                \ketslat
                =
                \bra{\slat} \hamil(t) e^{\clust(t)}
                \ketslat,
            \end{align}
            which should look familiar as the equation for the ground state
            energy in the time-independent coupled cluster method if the
            explicit time-dependence is removed from the Hamiltonian and the
            cluster amplitudes\footnote{%
                Note that we've removed cluster amplitudes from the left-hand
                side to get the same expression as
                \citeauthor{pedersen2018symplectic}.
            }.
            % TODO: Elaborate on why lambda_0(t) = 1.
